/*! https://github.com/leeoniya/uDSV (v0.6.0) */
var uDSV=function(e){"use strict";const l=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d{3,})?(?:Z|[-+]\d{2}:?\d{2}))?$/,t=/^(?:t(?:rue)?|f(?:alse)?|y(?:es)?|n(?:o)?|0|1)$/i,n=["\t","|",";",","],r="d",i="n",s="j",c="b";const o=JSON.stringify,f=e=>"string"==typeof e?o(e):e;function u(e,l){let{type:t}=l,n=`r[${e}]`,u=t===r?`new Date(${n})`:t===s?`JSON.parse(${n})`:t===i?"+"+n:t[0]===c?`${n} === ${o(t.slice(2))} ? true : false`:n,{repl:a}=l,h=void 0!==a.NaN&&t===i?`${n} === 'NaN' ? ${f(a.NaN)} : `:"",d=void 0!==a.null?`${n} === 'null' || ${n} === 'NULL' ? ${f(a.null)} : `:"";return`${void 0!==a.empty?`${n} === '' ? ${f(a.empty)} : `:""} ${d} ${h} ${u}`}const a=/\w+(?:\[|\]?[\.\[]?|$)/gm;function h(e,l=!1,t=!1){let n="";if(l&&t){let l={},t=0,r=e.map((e=>e.name.replace(/\.(\d+)\.?/gi,"[$1]")));do{let e=r.shift(),n=/\s/.test(e)?[e]:[...e.matchAll(a)].flatMap((e=>e.map((e=>e.replace("]",""))))),i=l;do{let e=n.shift(),l=e,r=e.at(-1);"."==r||"["==r?(l=e.slice(0,-1),i=i[l]=i[l]??("."==r?{}:[])):i[l]=`¦${t}¦`}while(n.length>0);t++}while(r.length>0);n=o(l).replace(/"¦(\d+)¦"/g,((l,t)=>u(+t,e[+t])))}else!l&&e.every((e=>"s"===e.type))?n="r":(n=l?"{":"[",e.forEach(((e,t)=>{n+=l?o(e.name)+":":"";let r=u(t,e);n+=r+","})),n+=l?"}":"]");return Function("rows",` let arr = Array(rows.length); for (let i = 0; i < rows.length; i++) { let r = rows[i]; arr[i] = ${n}; } return arr; `)}function d(e){return Function("rows",` let cols = [${e.map((()=>"Array(rows.length)")).join(",")}]; for (let i = 0; i < rows.length; i++) { let r = rows[i]; ${e.map(((e,l)=>`cols[${l}][i] = r[${l}]`)).join(";")}; } return cols; `)}function p(e,l,t,n=0,r=!0,i=1e3,s=null,c=null){let{row:o,col:f,encl:u,esc:a,trim:h}=l;u??=e.indexOf('"')>-1?'"':"",a??=u;let d=`${a}${u}`,p=c||l.cols.length,g=null!=s,$=null!=c&&g,y=o.length,m=f.length,A=u.charCodeAt(0),N=a.charCodeAt(0),k=o.charCodeAt(0),w=f.charCodeAt(0),C=0,b=0,O=e.length-1,x=0,v=[],E=Array(p).fill(""),S=E.slice(),j=0,L=p-1,T=-1;if(""===u){for(;O>=b;)if(j===L){let l=e.indexOf(o,b);if(-1===l){if(!r)break;l=O+1}let c=e.slice(b,l);if(S[j]=h?c.trim():c,0>--n&&v.push(S),v.length===i){let e=!1===t(v,"");if(v=[],e||g&&++C===s)return}S=E.slice(),j=0,T=-1,b=l+y,x=b}else if(0===j&&e.charCodeAt(b)===k)b+=y;else{let l=e.indexOf(f,b);if(-1===l&&!r)break;let t=e.slice(b,l);S[j]=h?t.trim():t,b=l+m,T=j++}return r&&j===L&&T>-1&&0>--n&&v.push(S),void(r&&0>=v.length||t(v,r?"":e.slice(x)))}const R=$?RegExp(`[^${f}${o}]+`,"my"):null;let Y=0,D="",F=0,J=b;for(;O>=b;){if(F=e.charCodeAt(b),0===Y)if(F===A){if(Y=2,b+=1,J=b,b>O)break;F=e.charCodeAt(b)}else if(F===w||F===k){if(F===k&&0===j){b+=y;continue}if(S[j]=D,T=j,j+=1,b+=1,D="",F===k){if($&&L>T&&0===v.length&&(S.length=E.length=T+1,L=T),0>--n&&v.push(S),v.length===i){let e=!1===t(v,"");if(v=[],e||g&&++C===s)return}S=E.slice(),j=0,T=-1,b+=y-1,x=b}if(b>O)break}else if(h&&32===F)for(;32===F;)F=e.charCodeAt(++b);else Y=1;if(2===Y){let l=!1,t=0;for(;;)if(F===A)if(A===N){if(b+1>O){t=b,b=O+1;break}if(e.charCodeAt(b+1)!==A){Y=0,t=b,b+=1;break}if(b+=2,l=!0,b>O)break;F=e.charCodeAt(b)}else{if(e.charCodeAt(b-1)!==N){Y=0,t=b,b+=1;break}if(b+=1,l=!0,b>O)break;F=e.charCodeAt(b)}else{let l=e.indexOf(u,b);if(-1===l){b=O+1;break}b=l,F=A}(0===Y||b>O)&&(D=l?e.slice(J,t).replaceAll(d,u):e.slice(J,t))}else if(1===Y)if(F===w||F===k){if(F===k&&0===j){b+=y;continue}if(S[j]=D,T=j,j+=1,b+=1,D="",F===k){if($&&L>T&&0===v.length&&(S.length=E.length=T+1,L=T),0>--n&&v.push(S),v.length===i){let e=!1===t(v,"");if(v=[],e||g&&++C===s)return}S=E.slice(),j=0,T=-1,b+=y-1,x=b}Y=0}else if($){R.lastIndex=b;let l=R.exec(e)[0];D=l,b+=l.length}else{let l=e.indexOf(j===L?o:f,b);-1===l&&(l=O+1);let t=e.slice(b,l);D=h?t.trim():t,b=l}}r&&j===L&&(S[j]=D,0>--n&&v.push(S),Y=0),t(v,r||0===Y&&!(-1===T?""!==D:L>T)?"":e.slice(x))}return e.inferSchema=function(e,o,f){let{header:u,col:a,row:h,encl:d,esc:g,trim:$=!1}=o??{};u??=e=>[e[0]],f??=10;const y=RegExp(`(.*)(${h??"\r\n|\r|\n"})`),m=e.match(y),A=m[1];h??=m[2],a??=n.find((e=>A.indexOf(e)>-1))??",";const N={skip:1,col:a,row:h,encl:d,esc:g,trim:$,cols:[]},k=A.split(a).length,w=[];p(e,N,(e=>{w.push(...e)}),0,!0,f,1,k);let C=u(w)??[],b=N.skip=C.length,O=C.find((e=>null!=e))??[...Array(w[0].length).keys()];return w.splice(0,b),O.forEach(((e,n)=>{let o=function(e,n){let o=n.findLast((l=>""!==l[e]&&"null"!==l[e]&&"NULL"!==l[e]&&"NaN"!==l[e])),f="s";if(null!=o){let n=o[e];f=l.test(n)?r:+n==+n?i:t.test(n)?c+":"+function(e){let[l,t=""]=e;return"1"==l||"0"==l?"1":"t"==l||"f"==l?""==t?"t":"true":"T"==l||"F"==l?""==t?"T":"R"==t||"A"===t?"TRUE":"True":"y"==l||"n"==l?""==t?"y":"yes":"Y"==l||"N"==l?""==t?"Y":"E"==t||"O"===t?"YES":"Yes":""}(n):function(e){if("["===e[0]||"{"===e[0])try{return JSON.parse(e),!0}catch{}return!1}(n)?s:f}return f}(n,w);N.cols.push({name:e,type:o,repl:{empty:null,NaN:void 0,null:void 0}})})),N},e.initParser=function(e,l){let{skip:t,cols:n}=e,r=null,i=null,s=null,c=null,o=null,f=null,u=0,a=0,g=null,$=null,y="",m="",A=null;function N(){a=u=0,m=y="",g=$=A=null}let k=(e,l)=>{l(e)},w=()=>[],C=()=>n.map((()=>[])),b=e=>{A.push(...e)},O=e=>{e.forEach(((e,l)=>{A[l].push(...e)}))};function x(n,r,i){let s=null;return(c,o=k)=>{s??=i(),A??=n();let f=A,h=0===a||2===a;return p(c,e,((e,l)=>{m=l;let t=o(s(e),r);return!1===t&&0!==a&&N(),t}),0===u?t:0,h,l),h&&(A=null),f}}const v=x(w,b,(()=>(r??=e=>e,r))),E=x(w,b,(()=>(o??=h(n.map((e=>({...e,type:"s",repl:{...e.repl,empty:void 0}}))),!0,!1),o))),S=x(w,b,(()=>(i??=h(n,!1,!1),i))),j=x(w,b,(()=>(s??=h(n,!0,!1),s))),L=x(w,b,(()=>(c??=h(n,!0,!0),c))),T=x(C,O,(()=>(i??=h(n,!1,!1),f??=d(n),e=>f(i(e))))),R=x(C,O,(()=>(f??=d(n),f)));return{schema:e,stringArrs:v,stringObjs:E,stringCols:R,typedArrs:S,typedObjs:j,typedDeep:L,typedCols:T,chunk(e,l=v,t=k){g??=l,$??=t,1===a&&(g(m+y,$),u++),y=e,a=1},end(){a=2;let e=g(m+y,$);return N(),e}}},e}({});
