/*! https://github.com/leeoniya/uDSV (v0.6.0) */
var uDSV=function(e){"use strict";const l=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d{3,})?(?:Z|[-+]\d{2}:?\d{2}))?$/,t=/^(?:t(?:rue)?|f(?:alse)?|y(?:es)?|n(?:o)?|0|1)$/i,n=["\t","|",";",","],r="d",i="n",s="j",c="b";const f=JSON.stringify,u=e=>"string"==typeof e?f(e):e;function o(e,l){let{type:t}=l,n=`r[${e}]`,o=t===r?`new Date(${n})`:t===s?`JSON.parse(${n})`:t===i?"+"+n:t[0]===c?`${n} === ${f(t.slice(2))} ? true : false`:n,{repl:a}=l,d=void 0!==a.NaN&&t===i?`${n} === 'NaN' ? ${u(a.NaN)} : `:"",h=void 0!==a.null?`${n} === 'null' || ${n} === 'NULL' ? ${u(a.null)} : `:"";return`${void 0!==a.empty?`${n} === '' ? ${u(a.empty)} : `:""} ${h} ${d} ${o}`}const a=/\w+(?:\[|\]?[\.\[]?|$)/gm;function d(e,l=!1,t=!1){let n="";if(l&&t){let l={},t=0,r=e.map((e=>e.name.replace(/\.(\d+)\.?/gi,"[$1]")));do{let e=r.shift(),n=/\s/.test(e)?[e]:[...e.matchAll(a)].flatMap((e=>e.map((e=>e.replace("]",""))))),i=l;do{let e=n.shift(),l=e,r=e.at(-1);"."==r||"["==r?(l=e.slice(0,-1),i=i[l]=i[l]??("."==r?{}:[])):i[l]=`¦${t}¦`}while(n.length>0);t++}while(r.length>0);n=f(l).replace(/"¦(\d+)¦"/g,((l,t)=>o(+t,e[+t])))}else!l&&e.every((e=>"s"===e.type))?n="r":(n=l?"{":"[",e.forEach(((e,t)=>{n+=l?f(e.name)+":":"";let r=o(t,e);n+=r+","})),n+=l?"}":"]");return Function("r","return "+n)}function h(e,l,t=0,n=(()=>!0),r=!0,i){let{row:s,col:c,encl:f,esc:u,trim:o}=l;f??=e.indexOf('"')>-1?'"':"",u??=f;let a=`${u}${f}`,d=i??l.cols.length,h=null!=i,p=s.length,$=c.length,g=f.charCodeAt(0),y=u.charCodeAt(0),m=s.charCodeAt(0),A=c.charCodeAt(0),b=["",!1],k=0,N=e.length-1,C=0,O=Array(d).fill(""),x=O.slice(),w=0,v=d-1,E=-1;if(""===f){for(;N>=k;)if(w===v){let l=e.indexOf(s,k);if(-1===l){if(!r)break;l=N+1}let i=e.slice(k,l);if(x[w]=o?i.trim():i,0>--t&&!1===n(x))return b[1]=!0,b;x=O.slice(),w=0,E=-1,k=l+p,C=k}else if(0===w&&e.charCodeAt(k)===m)k+=p;else{let l=e.indexOf(c,k);if(-1===l&&!r)break;let t=e.slice(k,l);x[w]=o?t.trim():t,k=l+$,E=w++}return 0>--t&&r&&w===v&&E>-1&&n(x),b[0]=r?"":e.slice(C),b}const S=h?RegExp(`[^${c}${s}]+`,"my"):null;let L=0,T="",j=0,R=k;for(;N>=k;){if(j=e.charCodeAt(k),0===L)if(j===g){if(L=2,k+=1,R=k,k>N)break;j=e.charCodeAt(k)}else if(j===A||j===m){if(j===m&&0===w){k+=p;continue}if(x[w]=T,E=w,w+=1,k+=1,T="",j===m){if(h&&v>E&&0===C&&(x.length=O.length=E+1,v=E),0>--t&&!1===n(x))return b[1]=!0,b;x=O.slice(),w=0,E=-1,k+=p-1,C=k}if(k>N)break}else if(o&&32===j)for(;32===j;)j=e.charCodeAt(++k);else L=1;if(2===L){let l=!1,t=0;for(;;)if(j===g)if(g===y){if(k+1>N){t=k,k=N+1;break}if(e.charCodeAt(k+1)!==g){L=0,t=k,k+=1;break}if(k+=2,l=!0,k>N)break;j=e.charCodeAt(k)}else{if(e.charCodeAt(k-1)!==y){L=0,t=k,k+=1;break}if(k+=1,l=!0,k>N)break;j=e.charCodeAt(k)}else{let l=e.indexOf(f,k);if(-1===l){k=N+1;break}k=l,j=g}(0===L||k>N)&&(T=l?e.slice(R,t).replaceAll(a,f):e.slice(R,t))}else if(1===L)if(j===A||j===m){if(j===m&&0===w){k+=p;continue}if(x[w]=T,E=w,w+=1,k+=1,T="",j===m){if(h&&v>E&&0===C&&(x.length=O.length=E+1,v=E),0>--t&&!1===n(x))return b[1]=!0,b;x=O.slice(),w=0,E=-1,k+=p-1,C=k}L=0}else if(h){S.lastIndex=k;let l=S.exec(e)[0];T=l,k+=l.length}else{let l=e.indexOf(w===v?s:c,k);-1===l&&(l=N+1);let t=e.slice(k,l);T=o?t.trim():t,k=l}}return r&&w===v&&(x[w]=T,0>--t&&n(x),L=0),b[0]=r||0===L&&!(-1===E?""!==T:v>E)?"":e.slice(C),b}return e.inferSchema=function(e,f,u){let{header:o,col:a,row:d,encl:p,esc:$,trim:g=!1}=f??{};o??=e=>[e[0]],u??=10;const y=RegExp(`(.*)(${d??"\r\n|\r|\n"})`),m=e.match(y),A=m[1];d??=m[2],a??=n.find((e=>A.indexOf(e)>-1))??",";const b={skip:1,col:a,row:d,encl:p,esc:$,trim:g,cols:[]},k=A.split(a).length,N=[];h(e,b,0,(e=>(N.push(e),u>N.length)),!0,k);let C=o(N)??[],O=b.skip=C.length,x=C.find((e=>null!=e))??[...Array(N[0].length).keys()];return N.splice(0,O),x.forEach(((e,n)=>{let f=function(e,n){let f=n.findLast((l=>""!==l[e]&&"null"!==l[e]&&"NULL"!==l[e]&&"NaN"!==l[e])),u="s";if(null!=f){let n=f[e];u=l.test(n)?r:+n==+n?i:t.test(n)?c+":"+function(e){let[l,t=""]=e;return"1"==l||"0"==l?"1":"t"==l||"f"==l?""==t?"t":"true":"T"==l||"F"==l?""==t?"T":"R"==t||"A"===t?"TRUE":"True":"y"==l||"n"==l?""==t?"y":"yes":"Y"==l||"N"==l?""==t?"Y":"E"==t||"O"===t?"YES":"Yes":""}(n):function(e){if("["===e[0]||"{"===e[0])try{return JSON.parse(e),!0}catch{}return!1}(n)?s:u}return u}(n,N);b.cols.push({name:e,type:f,repl:{empty:null,NaN:void 0,null:void 0}})})),b},e.initParser=function(e){let{skip:l,cols:t}=e,n=null,r=null,i=null,s=null,c=null,f=0,u=null,o=null,a="",p=null;function $(){f=0,a="",u=o=p=null}let g=(e,l,t)=>(t(l,e),!0),y=()=>[],m=()=>t.map((()=>[])),A=(e,l)=>{e.push(l)},b=Function("buf","row",` ${e.cols.map(((e,l)=>"buf["+l+"].push(row["+l+"])")).join(";")}; `);function k(t,n,r){let i=null;return(s,c=g)=>{i??=r();let u=null==p?l:0;p??=t();let o=p,d=0===f||2===f,y=!1;if(Array.isArray(s)){for(let e=0;s.length>e;e++)if(!1===c(i(s[e]),o,n)){y=!0;break}}else[a,y]=h(s,e,u,(e=>c(i(e),o,n)),d);return y&&0!==f&&$(),d&&(p=null),o}}const N=()=>(n??=e=>e,n),C=()=>(r??=d(t,!1,!1),r),O=k(y,A,N),x=k(y,A,(()=>(c??=d(t.map((e=>({...e,type:"s",repl:{...e.repl,empty:void 0}}))),!0,!1),c))),w=k(y,A,C),v=k(y,A,(()=>(i??=d(t,!0,!1),i))),E=k(y,A,(()=>(s??=d(t,!0,!0),s))),S=k(m,b,C),L=k(m,b,N);return{schema:e,stringArrs:O,stringObjs:x,stringCols:L,typedArrs:w,typedObjs:v,typedDeep:E,typedCols:S,chunk(e,l=O,t=g){u??=l,o??=t,f=1,u(a+e,o)},end(){f=2;let e=u(a,o);return $(),e}}},e}({});
